// zig fmt: off

//! Zobrist keys for position hashing.

const std = @import("std");
const lib = @import("lib.zig");
const types = @import("types.zig");

const uses = struct
{
    const rnd = @import("rnd.zig");
};

const Piece = types.Piece;
const Square = types.Square;

pub fn initialize() void {
    var random: uses.rnd.Random = .init(0);

    // First
    for (0..16) |pc| {
        for (0..64) |sq| {
            piece_square_keys[pc * 64 + sq] = random.next_u64();
        }
    }

    // Second
    for (Square.all) |sq| {
        ep_keys[sq.u] = random.next_u64();
    }
    // For safe XOR
    ep_keys[0] = 0;

    // TODO: check this!
    // Third
    for (0..16) |i| {
        if (i == 0 or std.math.isPowerOfTwo(i)) {
            castling_keys[i] = 0;
            var j: usize = 1;
            while (j < 16) : (j <<= 1) {
                if (i & j != 0) {
                    //castling_keys[i] ^= castling_keys[i];
                    //castling_keys[i] ^= castling_keys[j]; // TODO: WTF....
                    castling_keys[i] = 0;
                }
            }
        }
        else {
            castling_keys[i] = random.next_u64();
        }
    }

    btm_key = random.next_u64();
}

pub var piece_square_keys: [16 * 64]u64 = @splat(0);
pub var ep_keys: [64]u64 = @splat(0);
pub var castling_keys: [16]u64 = @splat(0);
pub var btm_key: u64 = 0;

const ptr_piece_square_keys: [*]const u64 = &piece_square_keys;
const ptr_ep_keys: [*]const u64 = &ep_keys;
pub const ptr_castling_keys: [*]const u64 = &castling_keys;

pub fn piece_square(pc: Piece, sq: Square) u64
{
    const idx: usize = pc.idx() * 64 + sq.u;
    return ptr_piece_square_keys[idx];
}

pub fn enpassant(sq: Square) u64
{
    return ptr_ep_keys[sq.u];
}

pub fn castling(castling_rights: u4) u64 {
    return ptr_castling_keys[castling_rights];
}

pub fn btm() u64 {
    return btm_key;
}




// // First generated.
// pub const piece_square_keys: [16 * 64]u64 = .{
//     0xe220a8397b1dcdaf,
//     0x6e789e6aa1b965f4,
//     0x06c45d188009454f,
//     0xf88bb8a8724c81ec,
//     0x1b39896a51a8749b,
//     0x53cb9f0c747ea2ea,
//     0x2c829abe1f4532e1,
//     0xc584133ac916ab3c,
//     0x3ee5789041c98ac3,
//     0xf3b8488c368cb0a6,
//     0x657eecdd3cb13d09,
//     0xc2d326e0055bdef6,
//     0x8621a03fe0bbdb7b,
//     0x8e1f7555983aa92f,
//     0xb54e0f1600cc4d19,
//     0x84bb3f97971d80ab,
//     0x7d29825c75521255,
//     0xc3cf17102b7f7f86,
//     0x3466e9a083914f64,
//     0xd81a8d2b5a4485ac,
//     0xdb01602b100b9ed7,
//     0xa9038a921825f10d,
//     0xedf5f1d90dca2f6a,
//     0x54496ad67bd2634c,
//     0xdd7c01d4f5407269,
//     0x935e82f1db4c4f7b,
//     0x69b82ebc92233300,
//     0x40d29eb57de1d510,
//     0xa2f09dabb45c6316,
//     0xee521d7a0f4d3872,
//     0xf16952ee72f3454f,
//     0x377d35dea8e40225,
//     0x0c7de8064963bab0,
//     0x05582d37111ac529,
//     0xd254741f599dc6f7,
//     0x69630f7593d108c3,
//     0x417ef96181daa383,
//     0x3c3c41a3b43343a1,
//     0x6e19905dcbe531df,
//     0x4fa9fa7324851729,
//     0x84eb4454a792922a,
//     0x134f7096918175ce,
//     0x07dc930b302278a8,
//     0x12c015a97019e937,
//     0xcc06c31652ebf438,
//     0xecee65630a691e37,
//     0x3e84ecb1763e79ad,
//     0x690ed476743aae49,
//     0x774615d7b1a1f2e1,
//     0x22b353f04f4f52da,
//     0xe3ddd86ba71a5eb1,
//     0xdf268adeb6513356,
//     0x2098eb73d4367d77,
//     0x03d6845323ce3c71,
//     0xc952c5620043c714,
//     0x9b196bca844f1705,
//     0x30260345dd9e0ec1,
//     0xcf448a5882bb9698,
//     0xf4a578dccbc87656,
//     0xbfdeaed9a17b3c8f,
//     0xed79402d1d5c5d7b,
//     0x55f070ab1cbbf170,
//     0x3e00a34929a88f1d,
//     0xe255b237b8bb18fb,
//     0x2a7b67af6c6ad50e,
//     0x466d5e7f3e46f143,
//     0x42375cb399a4fc72,
//     0x8c8a1f148a8bb259,
//     0x32fcab5daed5bdfc,
//     0x9e60398c8d8553c0,
//     0xee89cceb8c4064c0,
//     0xdb0215941d86a66f,
//     0x5ccde78203c367a8,
//     0xf1bcbc6a1ec11786,
//     0xef054fceee954551,
//     0xdf82012d0555c6df,
//     0x292566ff72403c08,
//     0xc4dd302a1bfa1137,
//     0xd85f219db5c554e1,
//     0x6a27ff807441bcd2,
//     0x96a573e9b48216e8,
//     0x46a9fdac40bf0048,
//     0x3dd12464a0ee15b4,
//     0x451e521296a7eea1,
//     0x56e4398a98f8a0fd,
//     0x7b7dc2160e3335a7,
//     0xc679ee0bebcb1cca,
//     0x928d6f2d7453424e,
//     0x1b38994205234c6d,
//     0x8086d193a6f2b568,
//     0x21c6e26639ac2c65,
//     0xd9dccac414d23c6f,
//     0x91cd642057e00235,
//     0x77fc607dc6589373,
//     0x05b8abe26dd3aee7,
//     0x12f6436ac376cc66,
//     0x64952424897b2307,
//     0xee8c2baf6343e5c3,
//     0xdc4c613d9eba2304,
//     0x3505b7796bd1a506,
//     0x8176daf800a05f50,
//     0x8bd8ff7a0385cdbc,
//     0x1a764a3cd78101da,
//     0xbe4d15bf6ca266ac,
//     0xa85e1f38bb2dc749,
//     0x56759a968493cd8c,
//     0xf3a9bce7336bd182,
//     0x365b15013741519b,
//     0x1f7a44a6b109ac94,
//     0x3521d628813cb177,
//     0x6a77afab0f7c9370,
//     0x179642d8cde95015,
//     0x5ef102a8fb354461,
//     0xf51c504764ed82f2,
//     0xc58427f041ce6808,
//     0xfad8fc45c9643c37,
//     0xcf8682f9a70fa9c0,
//     0x7e1b3b75a4005729,
//     0x992dd867927b52d8,
//     0x7fbd5db142f6791f,
//     0x370595aacab4adae,
//     0xb1392dbdc5ab61d6,
//     0x9fea7dfc79d452d9,
//     0x40b12b120085641c,
//     0xa192afe3157c85d0,
//     0xc847729f4e08f3a3,
//     0x6f1384a306c41fc2,
//     0x12d05c4045a39c19,
//     0x9899202fd20f0841,
//     0xe9c7191857e774b8,
//     0x4eead809af5b0cc3,
//     0xe809acafa23864a4,
//     0x4da1edaba1d0f7bd,
//     0x846eb9673349f8e4,
//     0x87bae55b86039fe8,
//     0x7f367b8bd953eff2,
//     0x3884700f650d04e1,
//     0xbfe4b2ab46980cad,
//     0xc5fc89075299106c,
//     0x37b2fa361adea7cd,
//     0x7d75d813f04895b4,
//     0x702f5b393f62c0e0,
//     0x0a3fc775f4ecf37f,
//     0xe4b23787a352437f,
//     0xf83fa245c34d6363,
//     0xb99bcf040786cf50,
//     0x38b6ea0a0e6c9d8a,
//     0x093fdc76776e37e1,
//     0x1a75e6f76ba7eee8,
//     0x442cdcfee9660c62,
//     0x22d58d35116b5e0b,
//     0x87d4a5180f6a3645,
//     0x589fb216bd82131b,
//     0x91d031cad319aec0,
//     0xabecf76a553d320b,
//     0xb8686cb347612dcf,
//     0xfcab66337c0a77f5,
//     0xac318214381ec437,
//     0x6eb7f0fca24494ae,
//     0xcf42861dcdc895a9,
//     0x4abad7a1586d7a91,
//     0xc21b318dc2f49745,
//     0xd49474dc2acbd1f0,
//     0xb1d4873747c1c8e1,
//     0x5434dc8c7d015bf6,
//     0xe1c486287511b6a9,
//     0xa8616df62e89a193,
//     0x31ce6319498d8347,
//     0xafd0b486123d6faa,
//     0xe6495f5d102301eb,
//     0x0dc51ced17a43c52,
//     0x8bcbcde81355ef2d,
//     0x2412af73fdee7cfc,
//     0xc8d589e486e29eed,
//     0x23390e8664517f89,
//     0x251ade58e8a6849d,
//     0xf8555dbd2e8f9cb0,
//     0xcb417c3eef54f7c3,
//     0x8028f8e1aac3a919,
//     0x10e31052acf748a0,
//     0x2d886c073b1e1b78,
//     0x972974d90df9faee,
//     0xbc1b7b38796893ba,
//     0x1958ed432070e652,
//     0xca5f297197a12dcc,
//     0xe025a27375704f28,
//     0x418010a570a924fb,
//     0x9828e2941bfc419c,
//     0x4fbacd2f52b85c1f,
//     0x33dd5b756211cc67,
//     0x23c8dfdd1db57ff0,
//     0x32f81801a1a8e901,
//     0x26884eac5ada36da,
//     0xcaa82f9bb42e37d4,
//     0x19fb1a7491d6a7d1,
//     0x5aa0243aa357f38e,
//     0xb31d917809e447f0,
//     0x3f9c197225215be0,
//     0xdc3c315a1e33c095,
//     0x3dd399ad533e80ac,
//     0x566f32cce8301d95,
//     0xc880188083d9ba21,
//     0xb9cc357f3b0e7d2e,
//     0x0237d2123a8a8d6c,
//     0xbf636e9aa7cbf6bd,
//     0xd7bd4284c4e2a6a7,
//     0xda2ebb47d50577a9,
//     0x90ba1c11b539087d,
//     0x44993d31552b4f57,
//     0x32c2d6f80a8a8898,
//     0x450583ed7fb54b19,
//     0xec2b0b09e50ef3ef,
//     0xd918a0b6e2efd65c,
//     0xe37a868d9785f572,
//     0x7d1a6118f2b0f37a,
//     0x9e2e3cc13b343439,
//     0xefd82c11212e37e8,
//     0xaf89c05cd4fc75ed,
//     0x55bc16bb9697108e,
//     0x6c4701fa5db69bee,
//     0x9237338441daf445,
//     0x248cf0831e81a5fc,
//     0xacc13557e77de273,
//     0x520970c25e06513a,
//     0x657329cb02987cab,
//     0xa9b0b3366a4e55a8,
//     0xc4d06ca2f39acdd4,
//     0x5dce37d68170cde1,
//     0x5f1e44e77e1854c9,
//     0x6883d452d55df899,
//     0x05c5bd62f1067032,
//     0xe680b683ce60fab0,
//     0x5dc9da3f286d18b1,
//     0x94b4bf3ab85ed6d8,
//     0xce65f449e3acc5a3,
//     0x34b0209642cea639,
//     0xc14c3c771d904827,
//     0x6addcee2bd9cdee5,
//     0xe24eed137ffbb613,
//     0x75dd58ef79963d1b,
//     0xfdb83ecf6cc24920,
//     0x7a1d0057c57169fb,
//     0x339200f4feb62d07,
//     0xd33f4d4ac88469f4,
//     0x8226f234e68dfee4,
//     0x320def4f2a105536,
//     0x7786f3b13aefc159,
//     0xb28225ac9df63ee2,
//     0x781b9d0376cc6044,
//     0x05bd0115226c6ab6,
//     0xd302230207bdfdab,
//     0xdb898abd8e0d2933,
//     0x9e79a397ba00b9cc,
//     0x89df84a5f0003ee8,
//     0x011f04f2a75fb9be,
//     0x5a5832bb47bcf19e,
//     0xcbdc6d34b7c7534d,
//     0x28a0d62b36f7e211,
//     0x56c4553d5d0b9393,
//     0x6926f3234c55dbf2,
//     0x13fd156d281831ab,
//     0x788fde493e59653d,
//     0x984456f3129d0de5,
//     0x75fef0b6764f4cba,
//     0x3d1500b0edf98a29,
//     0xa149d1519fd97dc4,
//     0x1288259c4a188588,
//     0x304014a30b42d718,
//     0x7e9d7e05138f2863,
//     0x8379ec73f35176f4,
//     0x72076caedab9cd77,
//     0x933d40d047d5c211,
//     0x521d6aec56c0137b,
//     0x4972307f6da2e896,
//     0x6381fc65071e876d,
//     0xe5eba2b5b975969a,
//     0xf9819878b6052e93,
//     0x42cab1f6274738af,
//     0xe8e4342ae5cfb767,
//     0x6eb46bd2bd74a766,
//     0x4dca29b4fd8880c0,
//     0xf5de3740c3cb338d,
//     0x7c0dddf3352b6dbd,
//     0xa6208f121e7b9d80,
//     0x22bb0c2a84214635,
//     0x0f721606cabc211e,
//     0xa434826569f1a127,
//     0x07c801c0f8fe99e7,
//     0x77335155fdf6900b,
//     0x7de131ff132472a9,
//     0x9614024d783ce84f,
//     0x0807e7c5ec9c7b14,
//     0x0c5857e188e1c693,
//     0x3c6250408655f23d,
//     0x1d94501ac76ca8cf,
//     0xa75002a693f4354a,
//     0x4bf2d03583341074,
//     0xcec9908f230b6711,
//     0xfc001b32f9982685,
//     0xa837b30638cacfb2,
//     0xdaa5f80fe9d0f70d,
//     0x45ab1a6a22d6bc17,
//     0x476cf802330034e5,
//     0x08b65c623f08199d,
//     0x619957d95328ea3c,
//     0xad6fed10cbda8dcd,
//     0xedb0d0d28761fcc0,
//     0x23a06397a6335d81,
//     0x2649be21534f387f,
//     0x6bad9f5f9193499b,
//     0x71cce7c3593342d9,
//     0xd6f316c5c285c4de,
//     0xb73a83eeec718640,
//     0x2804d8c04de3388b,
//     0xd9da1024dc5ea567,
//     0xf47ec04292326b23,
//     0xa6b94cf241e7e821,
//     0x0c1dee5409bc203f,
//     0x33ba05bc3ee276fa,
//     0x032cd31b757b30bb,
//     0x3ccd39a590b78295,
//     0x4a264b709d0105ef,
//     0x1fa19cfc9778db71,
//     0x8436631985e92e8b,
//     0x5d34de04733d0a15,
//     0x2b181597907baf2e,
//     0xcece4d103307428b,
//     0x63a90e6c8f8391c2,
//     0x4c47a8c4017695ec,
//     0x5fe135a23112e31b,
//     0xcbd065fd22102737,
//     0x63fa700bfc399149,
//     0xe23b1de2babad561,
//     0x50c2dbee5d134327,
//     0x93c051781267eff5,
//     0x9aa83a6d8eb8abb3,
//     0x2d2fe50e4473ade9,
//     0x5fa1690e247adf55,
//     0x62f4f57b730a8d16,
//     0x616308740e528066,
//     0x861731f13c272113,
//     0x3c6caec2abb41615,
//     0x58dc98d3a4b965df,
//     0xac67e58c447a30f3,
//     0x717d1b34d0f226b5,
//     0x5068123375a5b3c6,
//     0x65955f41cfd0e893,
//     0x7a05e7206258c3f8,
//     0x530b98a49018d298,
//     0x4164a427d5be9ebb,
//     0x8ed388d35f43ad87,
//     0xeda8fa6a8a59bc0e,
//     0xa6b3a6712afcd38a,
//     0x857b0535c58d6b14,
//     0x35ccc2bf24fbceb1,
//     0x91757f9b2437ce51,
//     0x4f9a23e2b151be74,
//     0x78779a725ea2d9fe,
//     0xcc4ec68084cc7e95,
//     0xb6966a6140bf3535,
//     0x89de59fa33170a0a,
//     0x45891bd34267a6ef,
//     0x68eb3b32aa806aac,
//     0xae2e7ecc4c8e0da9,
//     0x9c6973b1cd7c1a97,
//     0xb2a774c1f3488fb5,
//     0x00bb92e27d083dca,
//     0x5d9f2c93ff73a7a1,
//     0xf77effea672d02c9,
//     0x2c8f635e04e16818,
//     0x63ccdda60ab7b0a9,
//     0x1cce0bba630053b2,
//     0xeabd508b9df52a49,
//     0x85232b4a312d42a2,
//     0x907271a5478cde49,
//     0x5a63530cfad0b243,
//     0xab1a732b3f586b99,
//     0xadeae4869d4467b3,
//     0x2a4176cc70fa8c52,
//     0x871ed802e15cf126,
//     0x41a665fe26a7a248,
//     0xe6855668819e63a0,
//     0x7946342a93638d09,
//     0xcee7f6ce76c24791,
//     0x90746e60ef10929c,
//     0x303f222ec15a3656,
//     0x91ca8850bdb392a5,
//     0x282be21753fd8812,
//     0x8da4658f613ba6a7,
//     0x39f0f2e09ba26805,
//     0xe10e043370f4ce5f,
//     0xe3ef8013856fc40c,
//     0x10155b096e22e7f7,
//     0xb06fa4f0d3afe2d3,
//     0x98dabb1c64aa2138,
//     0x662426bd0482cb44,
//     0xd49604a4e3af5c6a,
//     0x1d73b2634c39403e,
//     0x894fb150a04be81c,
//     0x2a2e37a33a8f339d,
//     0x412b63228c0d97d9,
//     0xe4534eb1558ea880,
//     0x22d471edcc01f620,
//     0x1810596a0c2284f9,
//     0x55ea875e6ee39c26,
//     0xfda91f81674f3233,
//     0x99fb91542b2ef76c,
//     0x4850117266c0d41f,
//     0x4c84fdeeb5b71336,
//     0x5b65923ac30ec1f4,
//     0x001fce785e79eacc,
//     0xe7035aadba840af9,
//     0xef062cfb5d3a3fa4,
//     0x91cf003dc64d2047,
//     0x6a6bbae4c69f0558,
//     0xbc83ebe6cd2818d8,
//     0xc3a32910d5aeaa2d,
//     0x2f124b01d8c37ff7,
//     0x89908fb20936c74f,
//     0x30307ace765d040b,
//     0x2efc3e93492e7d12,
//     0xb5af6d95d72949ea,
//     0x9217fa5ec037abe8,
//     0xa27ca1090743f1bd,
//     0x9e58d128e268bc60,
//     0x331f5ff8d2f1ccca,
//     0x1318b39f628757d7,
//     0xf1eedce334401c5e,
//     0x10448c3a57ddd877,
//     0xc6220951fb35d453,
//     0xa492fa1749559626,
//     0xc16c742d1cc888f8,
//     0x4ee6be96e6483c3b,
//     0xd8c4cbbb86af34bd,
//     0xc23fe6e086e66126,
//     0x593573115d89d57d,
//     0xeae4b6ca31a0b512,
//     0x1303e0c57b6e8645,
//     0xa7ce5911a9cb5e60,
//     0xac52a06a93326442,
//     0x1cfa401114d214fe,
//     0x657c7edd5a6a2d11,
//     0x74f7dfc8ad75e5be,
//     0xb93bd966433a5eb5,
//     0x395abf3428c5ef4d,
//     0x3a7c844c5ed8c333,
//     0xc6a32156c0e52c52,
//     0x811e01f4016f91f7,
//     0x5fd205755dc324cf,
//     0x8b8e6cb9d7a25c5e,
//     0x6a393c91b09a4f24,
//     0x2419d24941d2879e,
//     0xcb11d3d322378c3f,
//     0x89a0d947e7359ba9,
//     0x9ac235af1b306ee2,
//     0xdb17fbea36289ad2,
//     0x5ede9c17dedafd6b,
//     0xef0cd7b4e4ec0de6,
//     0xa4b32cc50529ec8a,
//     0x3729e60466e76c72,
//     0xbc1b968695dfd347,
//     0x1208879d7d4bde63,
//     0x8eccc08b8c8ddefa,
//     0x61d1b6bfda572c2d,
//     0x2e5bfe8ae0bfc011,
//     0xbb93b47e50da3162,
//     0x4dc253ba47fe4964,
//     0x214619698f00fb1a,
//     0x7065de8fd6721979,
//     0x319c324c72c708c9,
//     0x5ef5bbc18466cf1d,
//     0xf1cae3b64977eec5,
//     0x6ff929d26a842420,
//     0xe8bab64cef650d0e,
//     0xa0fff83df2901695,
//     0xd0ae24de4223d192,
//     0xbc60367453eec23f,
//     0x6d8046b801afbc9d,
//     0x26018251926c0991,
//     0x1a68be3a035b5707,
//     0x242ae4893b70b22e,
//     0xb99c78cbc599a070,
//     0xed8916b381e9a6e2,
//     0x37695a55e05cd381,
//     0x5c6c9c4ed6632ee1,
//     0xcd463f48a9a8274e,
//     0x24e864649fafa6c7,
//     0xba69a8bac9998133,
//     0x292bb3d3fb84ffd6,
//     0x32fbf0c6bd46a684,
//     0xffa0d42a285685ce,
//     0xf8ec28585e907988,
//     0x955d78582b84939b,
//     0x7a8e5ece174ec569,
//     0x0bde70207d0f01f9,
//     0xf9d49516f6bcd773,
//     0x5ca61d38ace08dea,
//     0x73acebd3d49d7857,
//     0xf4721387d67a23c1,
//     0x400830fb417eed4f,
//     0x43613db3f0b2e10d,
//     0x0c2683675b3e7196,
//     0x0f0a3c18070a38e0,
//     0x00fba4231f3fd447,
//     0x4a83615e584ea5bb,
//     0xd1c390e9829e2e7d,
//     0x62c7bae420fe77b5,
//     0xca9b275e0cfacc12,
//     0x6e0bb5df568d5670,
//     0x47b0f2e81ea86cf0,
//     0x6b4b89c9cc0875b7,
//     0x4980af326a4b65d8,
//     0x83fcc71fa8833aa3,
//     0x327eee6ec9598964,
//     0x04dfae11b8dcf861,
//     0x4c3433717af5c89a,
//     0x22b7ba9e68349351,
//     0x47666d1b6fcaa9e7,
//     0x556e1ab391b34d79,
//     0xa6a3245dd1c3fe53,
//     0xa8241f6fae45b8d5,
//     0xc1d7ed7b9c6bec16,
//     0x9fc26e2d14919f22,
//     0x4fc2ccc9159d054f,
//     0x4a6881df0c028b9b,
//     0x45a577f1bab58960,
//     0xa1bdb57c6ca2dbc1,
//     0xebfde16cec9e9974,
//     0x4e7911ddbed4fc71,
//     0x71e606409319727b,
//     0xdc0d879ed0bbe640,
//     0x4293a2a13fb2fb89,
//     0xaf24d14180037e79,
//     0x53be5793563e006c,
//     0x157786cbc486d2a0,
//     0xb0752c30eaa58544,
//     0xbb61ee342e9a8210,
//     0x635d396b1bd1da07,
//     0x4d7c14a84bc6fdb5,
//     0x613a9c99235d15be,
//     0xfb7c05e13c1703fc,
//     0x3f7d3faa5694d6ae,
//     0x21dc527f0ab4ab9b,
//     0x0251b77b538e03fc,
//     0x802e57a14bf8215d,
//     0x51ec9407992ac5b8,
//     0x48a69543e5dc1734,
//     0x22abaa84fd19e270,
//     0x8f34cbb275b951ec,
//     0xdf92f91b1cb7a033,
//     0x157f0e4ccdb056a8,
//     0xd889bab710a7570e,
//     0xe180887a35c9acd9,
//     0x16c94ed584523d02,
//     0x3cb6b899028ba353,
//     0xade4153860320f39,
//     0x62a15d96596742b3,
//     0xc24e3101c5ab7a66,
//     0xd2f48e99a11767a6,
//     0x1542a77e8df4cc9f,
//     0x70450553f57c306f,
//     0x6596e4bb0ab6fe55,
//     0xb31ad51edb07e16d,
//     0x14f8ec0b2dd720c3,
//     0x66623fbeb6a18744,
//     0xbac8a59c8fc9f445,
//     0x0134cf3de391eae9,
//     0x3934dcea8dd8e425,
//     0x50621c6ebfc34e9b,
//     0xa0d5ee425797481a,
//     0xe65f9512ff9a97f3,
//     0x12a9fea1d634c54e,
//     0x043aab402beaaba8,
//     0x3fbaaa86d4844270,
//     0xe179606eaa9381e4,
//     0x54238caebf32828c,
//     0x6e3b64d7f5c88d2b,
//     0x685f1f2fc2e6b27a,
//     0xfd8563efde1f4398,
//     0x4423c5046aa5f8fa,
//     0x6bcf56187d539753,
//     0xd03a3b54209703fb,
//     0x251d485d8178acd6,
//     0x3f66ca397592e07f,
//     0x552bdfce433cc6cb,
//     0x44addd817db8b4df,
//     0xb000cbf3ce21b869,
//     0xd2e9983a72149fb3,
//     0xaf947e60ad892ed4,
//     0x577451b6ef6afcbf,
//     0x78da7cb7c466fbfd,
//     0xd5e3634444e34975,
//     0x344e8d54603a3643,
//     0x0b8d292730b546d0,
//     0x8acfe26983852baf,
//     0xf4fe6ba91c741977,
//     0x86d2315d1e0dc68a,
//     0x8d9d062df69ee643,
//     0x9ba452ec9b87acab,
//     0x60d53c599f2efcf5,
//     0x05cf9a10ae33fd6e,
//     0xed86e1913867a31f,
//     0xcbf6a4ee31486382,
//     0x5c088030503f61ea,
//     0x371da374bf0bbd06,
//     0x67325e50cebaafc4,
//     0x40613d7fabc27df7,
//     0x873450e33f8ec632,
//     0xc87c2173dd433a8d,
//     0xa337defd2fa45812,
//     0xc6d6572f9c4db5f7,
//     0x43df2a2bb9dc1f8e,
//     0xa949f99ae4579ae7,
//     0x2ce95f8710af973e,
//     0x9b6f7d1586d5c2a8,
//     0x1591bcac785b49b3,
//     0xefe019ea91a1cdb3,
//     0x0f308d530055c460,
//     0x549cbb2ebe9b6412,
//     0xe45cd3103ac8afb2,
//     0x8956d2c6a1c2a173,
//     0x3c6a03f08df43eca,
//     0x515e34df346c7f59,
//     0xdb1b56d7efbf053c,
//     0xad13006e7260fc0f,
//     0x9aa291b6d59d39df,
//     0x3a91dfda8521dd07,
//     0x30e27d3a3f4ad189,
//     0x1b7cd23c60e3768e,
//     0x1e65dbab69f02d4f,
//     0x647b114c433bbaa5,
//     0x7dcdca42f34b7db1,
//     0xc9bc4616c0261cf4,
//     0xbb980258f543d9bd,
//     0xd0867d4a79935127,
//     0x7faa29c4257de927,
//     0x7c47efc4dc9daeb3,
//     0xfc4455323ed6a688,
//     0xa6c803ab2fc31dc5,
//     0xfe3316e8a126c648,
//     0x0e4d6fee8331db63,
//     0x748cfa660c95016a,
//     0xb2747dbf2bc34adf,
//     0xfa6ed441e6468e9e,
//     0xae42190933ffc09a,
//     0xff9c92fd3654a582,
//     0xd33fcd8cd9e61ac5,
//     0x371ad28c40094647,
//     0x5d9dc02bb2d14812,
//     0xaa7bf2b3524699c7,
//     0x4cb261d764240af1,
//     0xeb0074eb49c8f038,
//     0x2235c793c6b2ec94,
//     0x326ce3de14b10487,
//     0x7d26c935d601635c,
//     0xfb023c83c005f89b,
//     0x7a7abfe47cf11a74,
//     0x326d14295729a098,
//     0x4051c8e5a0e36e25,
//     0xad5fb3df4788ab9b,
//     0xa06e91e446927881,
//     0x24765f3e77532660,
//     0x4ba5bdc5384f18c4,
//     0xc7f4e017f8732292,
//     0x6e992a983b7edde2,
//     0x8e833aefb26a1864,
//     0x1ba3adee92f08807,
//     0xd033c438ac3973ad,
//     0x109596208f6b9577,
//     0xc15e6593e972512a,
//     0xcac8e49bb608b4da,
//     0x8d2dda6d5c05dbe7,
//     0x61059bbb11e53600,
//     0x890dd6765d924d3b,
//     0x326a9a09a42a8f64,
//     0xba22ce1e7d55ac2e,
//     0x6e3070eca2371016,
//     0x4e6545c9f7372bbf,
//     0x44285c955996db95,
//     0xc2c610e81ca500cd,
//     0x6a2cf7bbc4f311bd,
//     0xfc4b27eaf1ce13b0,
//     0xb82b569d4298bdea,
//     0x73cbe4a05d9c604a,
//     0x0d0608d17a2f7994,
//     0xcf7e1d758bc7f5b5,
//     0x449c532e01903840,
//     0x109385b3578bc434,
//     0x5b0d87c9fca26014,
//     0x491c73c8f628c62a,
//     0x3079ee10edbe7ba1,
//     0x0cff6b3d3e6c15b8,
//     0x1d6b458f2c076c70,
//     0xc61d459c911f3537,
//     0xda68adbdc675be53,
//     0x8de990e037753ab0,
//     0xa6092d6f9f9e0b84,
//     0x5b3b3a90aa6ac400,
//     0x66598cc7b6406583,
//     0x1ca70aee97a1b837,
//     0xaf82a4ce58ef93b7,
//     0xc7ce4b9b13282484,
//     0x2b889662669711b0,
//     0x994f1f541e8ec4b1,
//     0xa04691fbe4451815,
//     0xe7450f8101bd21d5,
//     0xaa94a8216c7141a7,
//     0x06316d1c8dd41b5c,
//     0xfe600c367a8aa52b,
//     0x0577481e942a07a3,
//     0x1a3704f86eefde92,
//     0x1ddd864f1b50782b,
//     0x4e6e17f5f3b362db,
//     0x36c4e9881a205ff0,
//     0x87615288d5788a80,
//     0xf0ef34e4bd45b3fc,
//     0x1bc57badac418d9e,
//     0x9fc338c00035d21b,
//     0x17dda7edf8cea21b,
//     0x9bdae11a59ed17e3,
//     0x9aeb37281961af39,
//     0x426ac051d05d0541,
//     0x1f6bf9fcbd650853,
//     0xb6b485c32054d2db,
//     0x33cd737c1bd48bbc,
//     0xbf7d815f20c6aa90,
//     0xbddcaa250dae14ba,
//     0xeadf33672f2eef00,
//     0x1dfcf9099f404e93,
//     0x9322250b5159a644,
//     0xf317f503a92d62bf,
//     0xc81c284dd319fe2f,
//     0x6c99b2aac29b7da3,
//     0x09654e59fe299319,
//     0x7fac22d4a36c1cdb,
//     0x031c79fc0e5d0ba8,
//     0x6786f2a8b25df1e6,
//     0xc5d9b45dc06a2973,
//     0x494c1be2f16aa7e5,
//     0xcd6572b288330281,
//     0x1fec2ad7e539e591,
//     0x70ff92eac7d644eb,
//     0xa23a58e2a5158332,
//     0x8097046c8febebb5,
//     0xf48ef92917693662,
//     0xc768ecaf06040013,
//     0x64da73f83a1654d7,
//     0x4653bf0aa21d2e83,
//     0x89ceaa06806a3ab2,
//     0x11266d2e4dc768e4,
//     0x72e16539c447b502,
//     0xfa65940fded7d4c1,
//     0x4d12ed9b2035457c,
//     0xe945d4cb35ed57ed,
//     0x75d44c13bffb0f19,
//     0xf690c8970c88d47a,
//     0xe1ae0e7fc137e303,
//     0x5ce6c3417289b541,
//     0xd71c344eab53f9bf,
//     0xac337044a96df7af,
//     0xafe25963a3014e07,
//     0x5b92f7a78b315407,
//     0x120a9962ff1fa138,
//     0xbec62925bc2c2731,
//     0x840784564071255b,
//     0xb96ac0ee3219851f,
//     0x2b686d2aaf437b55,
//     0x862caf81e41a1a19,
//     0x1c787a8631a3cc4c,
//     0xada2b6b30a0fbd78,
//     0xe9bff1ac37cd3760,
//     0x5b1c44f240a786df,
//     0xdd2e5d6f2b4b30d5,
//     0x74cdd16b7f0fb3c4,
//     0x39edba15ba6d5dea,
//     0x893a48adc5c59fc3,
//     0x5d88d67ac62f910a,
//     0x6637c1ce6357a2c8,
//     0xfc7b432fba88a23c,
//     0xcbd18ebcd1f9b00d,
//     0xcc5d77cdfdf2f139,
//     0x0f87eec1b08afc93,
//     0xdad6d0b2edb856a9,
//     0xf1967332fb44fe31,
//     0x7e2ea1f8378a6b05,
//     0xf7030484c2112723,
//     0xc9270af5de5dd831,
//     0x17b0c92492db0be6,
//     0x65ef9855875761f5,
//     0xf70f6fc08fbc6cd2,
//     0x31a80f56d1763c8b,
//     0x719544336229e7d2,
//     0x297d5f1702685620,
//     0xfecaaf16b0750091,
//     0x4e48827cf8c61f54,
//     0x041cbea18af9baec,
//     0xbfc582141f1f8448,
//     0x1f2db364484c8c42,
//     0xb156cd02f199bf01,
//     0x805880df9cd1f3ef,
//     0xf1de0875b332446f,
//     0x81487f13496e7b8a,
//     0xa1c603e2d2b1c755,
//     0xb5be0c9a1bb00e12,
//     0x982fad98f4955b0b,
//     0x6f71eec14e3c2891,
//     0xd61f8c52a46143c3,
//     0x9be3190d6b9b942e,
//     0x6e8e1898868eb0a2,
//     0x553f7f84144a4c23,
//     0x228fd26aaba0c661,
//     0x98ec5ef763a53fcf,
//     0xa6ae40dddfd3d2f3,
//     0x1a9f21e6e88f29c1,
//     0x7abf2e6dbc13d977,
//     0xbf4e2f41816ea15e,
//     0x3ff81d2834cb6d60,
//     0xa8f148af30f4b908,
//     0xd6e2f0e513d0d43e,
//     0xb1bdab8e9dc78bf4,
//     0x219142e8b65466f4,
//     0x003f9cf0bcf3d599,
//     0x4615e70816e98019,
//     0x533b11bf7e56aad2,
//     0x0c5d654dedaa707a,
//     0x72dca3b0fc2499ed,
//     0x8b733297980fe1b3,
//     0x999051b19bfb8a9d,
//     0xdd0253a971577375,
//     0x69a7bf83e48e8c0d,
//     0xd7a6ad2b2561d503,
//     0x7907d7cf9a5031b0,
//     0x84ed151ff847e34a,
//     0x15be59597232432c,
//     0xfbe3ff25e49e4f60,
//     0x5e249603b186ffee,
//     0x8507c98608ea78c6,
//     0x9195b6d500d6ae15,
//     0xfec636268e3c8614,
//     0x08ada769154f454b,
//     0xc2500e05c8d70685,
//     0x58eb04418d0b1ad1,
//     0xc97791448b561151,
//     0x6c85ac83841a3e00,
//     0x9d47ceec316ed9a1,
//     0x52de011a7eddd2ac,
//     0xbc4b86a9c00b5e45,
//     0xded704b13adb6e3b,
//     0x4329a1e75142a10e,
//     0xe7e50951d69a7671,
//     0x557476edbb8a95ea,
//     0x663ebff1a5e39994,
//     0xaf9af9b3c29b2694,
//     0x453357c6b11305b1,
//     0x585e6dc6d06b262c,
//     0x58ed3a5d5d00380d,
//     0x4a32b3d69c5f01d5,
//     0x20891874afbbb0ef,
//     0xb1c90ce9e15b4f3c,
//     0x18aa1c1eeb83b16c,
//     0xf11899606a6d6736,
//     0xaf48318d5e70a70c,
//     0xa9286580641fbbfd,
//     0x36c56baa2207c4f9,
//     0xe0e958c0f377a821,
//     0x0f75ce694dc1214b,
//     0xcf159796fca24ac2,
//     0x4659e12f0dcd9b22,
//     0x181f9ca7e6edde4d,
//     0xe929338b0dabd75d,
//     0x9b44af40d00612df,
//     0x473b2fde7c81271a,
//     0x531a053abe4ff456,
//     0xd5c96d9663416a25,
//     0xe717d499fb7e07c9,
//     0xf345c856825636b0,
//     0xf19b5cf97a5256d2,
//     0x7e4abe7c23759694,
//     0xe011541207817d06,
//     0x1e85b7721b0da94e,
//     0x46fc5fae7f0111b6,
//     0xbee130c6a8eadbac,
//     0x5e2326a69245104a,
//     0xcaf8fdbab4d45a22,
//     0x3e71da41991cdaa4,
//     0xebc84d9fe6e487fb,
//     0x4fc6043c1494e02a,
//     0xd899f02fd3a838aa,
//     0xcb8fff34fe2991a0,
//     0x0c934108adc7a05b,
//     0x0cc782382665902b,
//     0x4039ce309b7c44b6,
//     0x0a2fef70e2e86413,
//     0xbbf44f08d99f71f0,
//     0xbe9d439b72a16fd9,
//     0xe083e973e85a0d41,
//     0xb59016b59e4fae77,
//     0xba969207a2d24a3e,
//     0x5c7e9d93361405e0,
//     0x120f608cb0b0dd50,
//     0x51996d8170206e76,
//     0xb8c208af5531ad2b,
//     0x1ef6c3fefe2a4be3,
//     0x5b4a1d2d79cf30d4,
//     0x451a1d408b25a91c,
//     0x20d510415336f591,
//     0xf865610091f9a8de,
//     0xe7e8b60122b7966d,
//     0x527388e726faf47a,
//     0xc024bfdbf760976a,
//     0xa9e2b0fe7eac52e3,
//     0x3d41bdc4fc80e848,
//     0xe9bd659eb1579de7,
//     0x7a714ce5673c8122,
//     0x972f832e08355295,
//     0xcdf44a12045d8dd0,
//     0xd3f0f8faa55212a9,
//     0xed3d984cb6644d81,
//     0x8be8d60b4485d41c,
//     0xb3cac41c4b918341,
//     0x0a0a2cdfa2008305,
//     0x94e6dbedbe6b68a3,
//     0x123e36c07ed816ff,
//     0x885f72f34bbe4785,
//     0x43329c4d29e3cffb,
//     0xf6979f488a710c47,
//     0x7e7cde8d8f46787b,
//     0x84a95bec490896b7,
//     0xc52618f6694b8387,
//     0x76a6c217d1089392,
//     0x026ee55dd2dd39c5,
//     0x59f5c6677a574d98,
//     0x2f2a9d5d0dd5a55c,
//     0x796214cffd60a880,
//     0x7ec3e4e0253c70e0,
//     0x934e9236377b91b0,
//     0x619286a21ef373e1,
//     0x45f9eab44163f574,
//     0x9c3c605e8d5b2b11,
//     0x9a2f227b30b811a5,
//     0x702a0d0a8ce6c733,
//     0xfa2d8827866d9fc6,
//     0xb4108938233d1830,
//     0x8a3dbdf68cd7478f,
//     0xba728edfb4b585ff,
//     0x83283d3057c3dbdc,
//     0x7660e3423e1ad80e,
//     0xade45225fdb20295,
//     0x962c6522f4f079df,
//     0x868d023f5fbf1093,
//     0xabf6a70a2a6b42a8,
//     0x56fe1d479716ba2f,
//     0x9813381202146af8,
//     0xe55ccd6690bffa90,
//     0x1704394c3eb89798,
//     0x9a6e866a9dc9abf0,
//     0x93b164239e813f5d,
//     0x2314e36753d7c4ce,
//     0x802e5174e8540765,
//     0xec9a47306f30514f,
//     0xad2dd576a5ce1156,
//     0x30b231ea97bcdd39,
//     0x352ba4c080b9c7e7,
//     0xe82b6f0a8f1223bf,
//     0x2307f663fc695848,
//     0x250ca4352f2f3f59,
//     0x2b06d21d3092a0f3,
//     0xc762ef5ee4ec6f0e,
//     0x14c9b2f083e10ca8,
//     0x225185718b516dda,
//     0x9e48481bbdcf6f7e,
//     0xcf05039e1fcfde99,
//     0xf88653cb07cb44aa,
//     0xf4568323204bfc56,
//     0x44b25f42bf60a917,
//     0x2d5b6baff2b4274b,
//     0xebc80a0626163999,
//     0x6ccb50acd0bc7529,
//     0xd7e256de2d8ccb63,
//     0xdff1daeab724b4b6,
//     0x0544c135018be211,
//     0xc2871c3da105747c,
//     0xbc6263c3ea5c60a8,
//     0x60f31c81c295713f,
//     0xf27ed05a79ae9faf,
//     0x9c6f22e716537e6d,
//     0x01aa054d293d992d,
//     0x87142d777055abba,
//     0x94af7aea9ee8c3f3,
//     0xad84533a4b9dbd08,
//     0xe2fb4ef179f18ce6,
//     0x1261e404c6a53438,
//     0x6ced8657f15f4dc2,
//     0x4e1c842ba2b38949,
//     0x118ff129dc6fe759,
//     0x371732bcd7aafe34,
//     0x96f74c6d5a2743d8,
//     0x82c1e9ad78bfdac2,
//     0x13ca922f0af7dcbc,
//     0x14e0abb2bfcf7c3e,
//     0x2cfa2f23425329e1,
//     0xdcad513c211f942d,
//     0x7b9b825c35c18b75,
//     0xad1d5088c022a188,
//     0xf804f37aa5267870,
//     0x5ef0afac47dcdf79,
//     0x315974ec6c94b8bd,
//     0x96c792007d4d6def,
//     0x716dc70126a22888,
//     0x8ff949d9b2334c46,
//     0x39d99bef581fe0d3,
//     0x70b322adc0939f80,
//     0xaf273e82d37541bc,
//     0xf43d8225366812aa,
//     0x7dc7392b1197006f,
//     0x619c7313cb6308fc,
//     0xf6dd0bff853210c5,
//     0x49cb12f89f2428ee,
//     0x1a388cc8169dda78,
//     0x293fa87171ec42a0,
//     0xb055491d413a1636,
//     0xb350348997b6ecdb,
//     0xf69029b901efa3ad,
//     0x2cdf2105ab2a3571,
// };

// // Second generated.
// pub const ep_keys: [64]u64 = .{
//     0x0000000000000000,
//     0x02ec155877fe5197,
//     0x9acb73c63488b544,
//     0xede8f6a37fcc2cb7,
//     0xa1edcbb1fec6412d,
//     0x386d687e05228a93,
//     0x3f85c7fe3f785264,
//     0x6f639edcc040b8e5,
//     0xdfce21f83b7755ff,
//     0xa601bd724de89bbc,
//     0x8aac30d865ab3cb7,
//     0xbd7ae693afc834ae,
//     0x20192f04754c32b2,
//     0xc100953ea60b69d7,
//     0x973999a9d24aa499,
//     0xe7240b58f7437b66,
//     0xe668587f1d4a037f,
//     0x06ae1c54dd761a39,
//     0xca07d06bee139491,
//     0x6393c105dde1c64e,
//     0xd5255d8c378b98e2,
//     0xd4552612c1f1d4f9,
//     0x30690c25ed4f7cef,
//     0xdc34e363aca033e7,
//     0xfa7a7e12a7b013cf,
//     0xfaf3411ec4419276,
//     0xc809163506c7e8b3,
//     0x8b4aefe3756b12c0,
//     0xa21824f63c2589b5,
//     0x55b6219c5b913bcf,
//     0x076b58f812dc9c02,
//     0x6ccc0c955063d06c,
//     0x398e82b74e12edbe,
//     0xa23b8182a1b85711,
//     0x3d23786aa371c9d3,
//     0x109154a4c05cd63f,
//     0xfa853e863bfe9035,
//     0xb30d96588269c854,
//     0x66c73752db5307e9,
//     0x296a0e365de45193,
//     0x78ca41583772a5b0,
//     0xc46bdfe034420633,
//     0xd3211ad946f6ed88,
//     0x3c4cf8e28d2f8144,
//     0xa10f9e704282773b,
//     0xee9bd7282c23bd8a,
//     0x81782d05daedfbf3,
//     0x60ea5863d54b0a88,
//     0x163f2a81dc6fe620,
//     0x3596a1576c0e92da,
//     0x0b3c5e690bce60f5,
//     0xc054f621443fd761,
//     0xa1ed3b3bf1dcb889,
//     0xc9a635ad26e2d0ea,
//     0x73a38af6a00c0b84,
//     0x4a0f35afad1087c4,
//     0x3b6d91c19ff13e05,
//     0x90d5ce60b4758cb9,
//     0x0da5582499eadb64,
//     0xac6b53949cf432bd,
//     0x203a49718d3b7b63,
//     0x0b35626d6ade27b3,
//     0xafff333119e2c51a,
//     0xd8ed26c708f4957e,
// };

// // Third generated
// pub const castling_keys: [16]u64 = .{
//     0x0000000000000000,
//     0x0000000000000000,
//     0x0000000000000000,
//     0x11849b2f994b24f4,
//     0x0000000000000000,
//     0xfedb3214154d889a,
//     0x297f4020cfbbd623,
//     0x0714d9e98f934930,
//     0x0000000000000000,
//     0x58e7241018095feb,
//     0x69872186b327d60f,
//     0xafc825616a2c77f9,
//     0x1fa822b5ad17358a,
//     0x5367bdeb91b31f7b,
//     0xb0632057a55fce36,
//     0x3ab2a323be2f67ef,
// };

// pub const btm_key: u64 = 0xec5efdb0545ef5eb;


// // for (z.piece_square_keys, 0..) |k, i| {
// //     lib.io.debugprint("0x{x:0>16},\n", .{k});
// //     std.debug.assert(k == z.pc_sq[i]);
// // }

// // for (z.ep_keys, 0..) |k, i| {
// //     lib.io.debugprint("0x{x:0>16},\n", .{k});
// //     // _ = i;
// //     std.debug.assert(k == z.ee[i]);
// // }

// // for (z.castling_keys, 0..) |k, i| {
// //     lib.io.debugprint("0x{x:0>16},\n", .{k});
// //      _ = i;
// //     //std.debug.assert(k == z.ee[i]);
// // }


// // lib.io.debugprint("0x{x:0>16}  0x{x:0>16},\n", .{z.btm(), z.black_tm});

// // for (p.Layouts.all, 0..) |backrow, i| {
// //     lib.io.debugprint("{} {any}\n", .{i, backrow});
// // }
